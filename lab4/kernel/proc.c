
/*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                               proc.c
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                                    Forrest Yu, 2005
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/

#include "type.h"
#include "const.h"
#include "protect.h"
#include "tty.h"
#include "console.h"
#include "string.h"
#include "proc.h"
#include "global.h"
#include "proto.h"

/*======================================================================*
                              schedule
 *======================================================================*/
PUBLIC void schedule() {
  while (1) {
    p_proc_ready++;
    if (p_proc_ready >= proc_table + NR_TASKS + NR_PROCS) {
      p_proc_ready = proc_table;
    }
    if (get_ticks() >= p_proc_ready->wakening_moment) {
      break;
    }
  }
}

/*======================================================================*
                           sys_get_ticks
 *======================================================================*/
PUBLIC int sys_get_ticks() {
  return ticks;
}

/*======================================================================*
                           sys_sleep
 *======================================================================*/
PUBLIC void sys_sleep(int milli_sec) {
  p_proc_ready->wakening_moment = get_ticks() + milli_sec / (1000 / HZ);
  schedule();
}

/*======================================================================*
                           sys_puts
 *======================================================================*/
PUBLIC void sys_puts(char *str) {
  disp_str(str);
}

/*======================================================================*
                           sys_sem_post
 *======================================================================*/
PUBLIC void sys_sem_post(sem_t *sem) {
}

/*======================================================================*
                           sys_sem_wait
 *======================================================================*/
PUBLIC void sys_sem_wait(sem_t *sem) {
}

